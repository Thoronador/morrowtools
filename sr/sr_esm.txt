
Format of Skyrim's ESM PlugIn Files

(All that follows below is still an assumption!)


  Record
  ======
    4 bytes: char Name[4]
        4-byte record name string (not null-terminated)
    4 bytes: long Size
        Size of the record not including the 20 bytes of header data.
	16 bytes:
		Unknown values, probably four groups of 4-byte integers/ flags



  (Sub-)Record
  ============
    4 bytes: char Name[4]
        4-byte sub-record name string (not null-terminated)
    2 bytes: uint16 Size
        Size of the sub-record not including the 6 bytes of header data.
    ? bytes: Sub-Record data.
        Format depends on the sub-record type).


  Groups:
  =======
    GRUP
      4 byte - uint32 - size of group, including the header
      4 byte - char[4] - name of group to follow
      12 byte - unknown data
      ? bytes - group data


Records and their sub-records:

  TES4: Main header(?)
      HEDR (12 bytes)
        Unknown, possibly three 4-byte values?
        4 bytes - float, version number
        4 bytes - unknown
        4 bytes - unknown
      CNAM - null-terminated string
      INTV (4 bytes)
        4 bytes - integer value


  GMST: Game Settings
      EDID: editor ID (string, 0-terminated)
      DATA: the data (string/int/float)
              format determined by first character of ID
              s = string (length varies)
              i = integer (4 bytes)
              f = floating point value (4 bytes)


  GLOB: global variables
      EDID: editor ID (string, NUL-terminated)
      FNAM (1 byte)
          type (s=short, l=long, f=float)
      FLTV (4 bytes)
          value (always stored as float?)


  KYWD: Keyword (whatever that may be)
      EDID (string, NUL-terminated)
          editor ID
      CNAM (4 bytes) - optional subrecord
          unknown value


  EYES: eyes
      EDID: (string, NUL-terminated)
          editorID
      FULL (4 byte)
          unknown data
      ICON  (string, NUL-terminated)
          texture path
      DATA (1 byte)
          unknown data (flags?)

  AACT: action(?)
      EDID (string, NUL-terminated)
          editorID


  SOUN: sound
      EDID (string, NUL-terminated)
          editorID
      OBND (12 bytes)
          unknown
      FNAM (string, NUL-terminated) optional
          file name
      SNDD (36 bytes) optional
          unknown
      SDSC (4 bytes)
          unknown ("sound source"?)


  COBJ: craftable object (recipes)
      EDID (string, NUL-terminated)
          editorID
      COCT (4 bytes) (not present, if there are no CNTO subrecords)
          component count (uint32_t)
      CNTO (8 bytes, occurs 0+ times)
          formID of required component (uint32_t)
          count (uint32_t)
      CTDA (32 bytes, can occur multiple times, optional)
          unknown
      CNAM (4 bytes)
          some formID
      BNAM (4 bytes)
          another formID
      NAM1 (2 bytes)
          resulting quantity (uint16_t)


  MISC: misc. object
      EDID (string, NUL-terminated)
         editorID
      VMAD (size varies) optional
          unknown data
      OBND (12 bytes)
          unknown data
      FULL (4 bytes) optional
          unknown, formID?
      MODL (string, NUL-terminated)
          model path
      MODT (size varies)
          unknown data
      MODS (size varies?) optional
          unknown data
      ICON (string, NUL-terminated) optional
          icon path
      KSIZ (4 bytes) optional
          number of uint32_ts in KWDA
      KWDA (KSIZ * 4 bytes) optional, follows KSIZ
          keyword formIDs (?)
      YNAM (4 bytes) optional
          unknown, formID(?)
      ZNAM (4 bytes) optional
          unknown, formID(?)
      DATA (8 bytes)
          unknown data, but looks like an uint32_t and a float, in that order


  TXST: texture set
      EDID (string, NUL-terminated)
          editorID
      OBND (12 bytes)
          unknown data
      TX00 (string, NUL-terminated)
          first texture path
      TX01 (string, NUL-terminated) optional
          second texture path
      TX02 (string, NUL-terminated) optional
          third texture path
      TX03 (string, NUL-terminated) optional
          another texture path
      TX04 (string, NUL-terminated) optional
          another texture path
      TX05 (string, NUL-terminated) optional
          another texture path
      TX07 (string, NUL-terminated) optional
          another texture path
      DODT (36 bytes) optional
          unknown data
      DNAM (2 bytes)
          unknown data


  BOOK: book
      EDID (string, NUL-terminated)
          editorID
      VMAD (?? bytes, optional)
          unknown data
      OBND (12 bytes)
          unknown
      FULL (4 bytes, optional)
          unknown
      MODL (string, NUL-terminated)
          model path
      MODT (size varies)
          unknown data
      DESC (4 bytes)
          unknown
      YNAM (4 bytes, optional)
          unknown
      KSIZ (4 bytes, optional)
          number of uint32_ts in KWDA
      KWDA (multiple of 4 bytes), follows KSIZ, therefore optional
          array of formIDs/uint32_t2, number of elements is specified in KSIZ
      DATA (10 bytes)
          unknown data
      INAM (4 bytes, optional)
          unknown
      CNAM (4 bytes)
          unknown


   ACTI: activator
       EDID (string, NUL-terminated)
          editorID
      VMAD (?? bytes, optional)
          unknown data
      OBND (12 bytes)
          unknown
      FULL (4 bytes, optional)
          unknown
      MODL (string, NUL-terminated, optional)
          model path
      MODT (?? bytes, optional)
          unknown
      MODS (?? bytes, optional)
          unknown
      DEST (8 bytes, optional)
          unknown
      DSTD (20 bytes, optional)
          unknown
      DMDL (string, NUL-terminated, optional)
          another model path
      DMDT (?? bytes, optional)
          unknown
      DMDS (?? bytes, optional)
          unknown
      DSTF (?? bytes, optional)
          unknown
      KSIZ (4 bytes, optional)
          number of uint32_ts in KWDA
      KWDA (multiple of 4 bytes), follows KSIZ, therefore optional
          array of formIDs/uint32_t2, number of elements is specified in KSIZ
      PNAM (4 bytes)
          unknown
      VNAM (4 bytes, optional)
          unknown
      WNAM (4 bytes, optional)
          unknown
      RNAM (4 bytes, optional)
          unknown
      FNAM (2 bytes)
          unknown
      KNAM (4 bytes, optional)
          unknown


  QUST: quest
      EDID (string, NUL-terminated)
          editorID
      VMAD (?? bytes, optional)
          unknown data
      FULL (4 bytes)
          unknown
      DNAM (12 bytes)
          unknown
      ENAM (4 bytes, optional)
          unknown
      FLTR (string, NUL-terminated, optional)
          filter of some sort
      NEXT (always zero bytes?)
          unknown/no data

        INDX (4 bytes)
            quest stage index
        QSDT (1 byte)
            set to 1, if it finished the quest
        CNAM (4 bytes)
            string ID of entry name?



      ANAM (4 bytes)
          unknown
      CTDA (32 bytes, optional, can occur multiple times)
          unknown
      ... and much more


  WOOP: Word of Power
      EDID (string, NUL-terminated)
          editorID
      FULL (4 bytes) optional
          unknown data
      TNAM (4 bytes)
          unknown data


  SHOU: Dragon Shout
      EDID (string, NUL-terminated)
          editorID
      FULL (4 bytes) optional
          string ID of shout's full name
      MDOB (4 bytes) optional
          unknown data
      DESC (4 bytes)
          string ID of shout's description
      SNAM (12 bytes, occurs three times)
          unknown data


  WEAP: Weapon record
      EDID: editor ID (string, NUL-terminated)
      OBND (12 bytes)
          unknown data
      FULL (4 bytes?)
          unknown data
      MODL (string)
          model path (.NIF)
      MODT (12, 24 or 36 bytes possible?, maybe in general a multiple of 12 bytes)
          unknown data
      EITM (4 bytes)
          unknown data
      EAMT (2 bytes)
          unknown data
      ETYP (4 bytes)
          unknown data
      BIDS (4 bytes)
          unknown data
      BAMT (4 bytes)
          unknown data
      KSIZ (4 bytes)
          number of uint32_ts in KWDA
      KWDA (multiple of 4 bytes), follows KSIZ
          array of formIDs/uint32_t2, number of elements is specified in KSIZ
      DESC (4 bytes)
          unknown data (description?)
      INAM (4 bytes)
          unknown data
      WNAM (4 bytes)
          unknown data
      TNAM (4 bytes)
          unknown data
      NAM9 (4 bytes)
          unknown data
      NAM8 (4 bytes)
          unknown data
      DATA (10 bytes)
          unknown data
      DNAM (100 bytes)
          unknown data
      CRDT (16 bytes)
          unknown data
      VNAM (4 bytes)
          unknown data