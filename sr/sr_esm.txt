
Format of Skyrim's ESM PlugIn Files

(All that follows below is still an assumption!)


  Record
  ======
    4 bytes: char Name[4]
        4-byte record name string (not null-terminated)
    4 bytes: long Size
        Size of the record not including the 20 bytes of header data.
	16 bytes:
		Unknown values, probably four groups of 4-byte integers/ flags



  (Sub-)Record
  ============
    4 bytes: char Name[4]
        4-byte sub-record name string (not null-terminated)
    2 bytes: uint16 Size
        Size of the sub-record not including the 6 bytes of header data.
    ? bytes: Sub-Record data.
        Format depends on the sub-record type).


  Groups:
  =======
    GRUP
      4 byte - uint32 - size of group, including the header
      4 byte - char[4] - name of group to follow
      12 byte - unknown data
      ? bytes - group data


Records and their sub-records:

  TES4: Main header(?)
      HEDR (12 bytes)
        Unknown, possibly three 4-byte values?
        4 bytes - float, version number
        4 bytes - unknown
        4 bytes - unknown
      CNAM (string, NUL-terminated)
        author name
      INTV (4 bytes)
        unknown integer value


  GMST: Game Settings
      EDID: editor ID (string, 0-terminated)
      DATA: the data (string/int/float)
              format determined by first character of ID
              s = string (length varies)
              i = integer (4 bytes)
              f = floating point value (4 bytes)


  ARMO: armour
      EDID (string, NUL-terminated)
          editor ID
      VMAD (size varies, optional)
          unknown data
      OBND (12 bytes)
          unknown data
      FULL (4 bytes, optional)
          string ID of name
      EITM (4 bytes, optional)
          unknown data
      MOD2 (string, NUL-terminated, optional)
          model path
      MO2T (size varies, optional)
          unknown data
      MO2S (size varies, optional)
          unknown data
      MOD4 (string, NUL-terminated, optional)
          model path
      MO4T (12 bytes, optional)
          unknown data
      MO4S (size varies, optional)
          unknown data
      BODT (12 bytes or 8 bytes)
          unknown data
      ETYP (4 bytes, optional)
          unknown data
      BIDS (4 bytes, optional)
          unknown data
      BAMT (4 bytes, optional)
          unknown data
      YNAM (4 bytes, optional)
          unknown data
      ZNAM (4 bytes, optional)
          unknown data
      RNAM (4 bytes)
          unknown data
      KSIZ (4 bytes, optional)
          number of uint32_ts in KWDA
      KWDA (n * 4 bytes, optional)
          array of uint32_ts/form IDs
      DESC (4 bytes, optional)
          string ID of description (mostly zero, i.e. unused)
      MODL (4 bytes, can occur 1+ times)
          unknown data
      DATA (8 bytes)
          unknown data
      DNAM (4 bytes)
          unknown data
      TNAM (4 bytes, optional)
          unknown data


  GLOB: global variables
      EDID (string, NUL-terminated)
          editor ID
      FNAM (1 byte)
          type (s=short, l=long, f=float)
      FLTV (4 bytes)
          value (always stored as float?)

  KEYM: key
      EDID (string, NUL-terminated)
          editor ID
      VMAD (size varies, optional)
          unknown data
      OBND (12 bytes)
          unknown data
      FULL (4 bytes)
          unknown data
      MODL (string, NUL-terminated)
          model path
      MODT (36 bytes)
          unknown data
      YNAM (4 bytes, optional)
          unknown data
      ZNAM (4 bytes, optional)
          unknown data
      KSIZ (4 bytes, optional)
          number of keywords in following KWDA
      KWDA (n*4 bytes, optional)
          array of form IDs
      DATA (8 bytes)
          unknown data


  KYWD: Keyword (whatever that may be)
      EDID (string, NUL-terminated)
          editor ID
      CNAM (4 bytes) - optional subrecord
          unknown value


  ALCH: alchemy stuff (potions?)
      EDID (string, NUL-terminated)
          editorID
      OBND (12 bytes)
          unknown data
      FULL (4 bytes, optional)
          unknown data
      KSIZ (4 bytes, optional)
          number of items in KWDA
      KWDA (n * 4 bytes, optional)
          array of form IDs/uint32_ts
      MODL (string, NUL-terminated)
          model path
      MODT (?? bytes)
          unknown data
      MODT (?? bytes, optional)
          unknown data
      YNAM (4 bytes, optional)
          unknown data
      ZNAM (4 bytes, optional)
          unknown data
      DATA (4 bytes)
          unknown data
      ENIT (20 bytes)
          unknown data
      EFID (4 bytes)
          unknown data
      EFIT (12 bytes)
          unknown data, but first 4 bytes seem to be a float


  APPA: apparatus
      EDID (string, NUL-terminated)
          editorID
      OBND (12 bytes)
          unknown data
      FULL (4 bytes)
          unknown data
      QUAL (4 bytes)
          unknown data
      DESC (4 bytes)
          unknown data
      DATA (8 bytes)
          unknown data


  DOOR: door
      EDID (string, NUL-terminated)
          editorID
      VMAD (size varies, optional)
          unknown data
      OBND (12 bytes)
          unknown data
      FULL (4 bytes, optional)
          unknown data
      MODL (string, NUL-terminated, optional)
          model path
      MODT (36 bytes, optional)
          unknown data
      MODS (size varies, optional)
          unknown data
      SNAM (4 bytes, optional)
          unknown data
      ANAM (4 bytes, optional)
          unknown data
      FNAM (1 byte)
          unknown data


  EYES: eyes
      EDID (string, NUL-terminated)
          editorID
      FULL (4 bytes)
          unknown data
      ICON  (string, NUL-terminated)
          texture path
      DATA (1 byte)
          unknown data (flags?)


  EQUP: equipment slot
      EDID: (string, NUL-terminated)
          editorID
      PNAM (n*4 bytes, optional)
          unknown data
      DATA (4 bytes)
          unknown data


  LCRT: location reference type
      EDID (string, NUL-terminated)
          editor ID
      CNAM (4 bytes, optional)
          unknown value


  LTEX: landscape texture
      EDID (string, NUL-terminated)
          editorID
      TNAM (4 bytes, optional)
          unknown data
      MNAM (4 bytes)
          unknown data
      HNAM (2 bytes)
          unknown data
      SNAM (1 byte)
          unknown data
      GNAM (4 bytes, optional, occurs 0+ times)
          unknown data


  GRAS: grass data
      EDID (string, NUL-terminated)
          editorID
      OBND (12 bytes)
          unknown data
      MODL (string, NUL-terminated)
          model path
      MODT (?? bytes)
          unknown data
      DATA (32 bytes)
          unknown data


  IMGS: image space
      EDID (string, NUL-terminated)
          editorID
      ENAM (56 bytes, optional)
          unknown data, but some (all?) of them look like floats
      HNAM (36 bytes, optional)
          unknown data, but some (all?) of them look like floats
      CNAM (12 bytes, optional)
          unknown data, most likely all floats
      TNAM (16 bytes, optional)
          unknown data, most likely all floats
      DNAM (12 or 16 bytes, optional)
          unknown data, possibly all floats


  IPDS: impact data set
      EDID (string, NUL-terminated)
          editorID
      PNAM (8 bytes, occurs multiple times)
          unknown data, but looks like two uint32/form IDs


  VTYP: voice type
      EDID (string, NUL-terminated)
          editorID
      DNAM (1 byte)
          unknown data


  WATR: voice type
      EDID (string, NUL-terminated)
          editorID
      FULL (4 bytes, optional)
          unknown data
      NNAM (string, NUL-terminated, seems to appear three times in a row)
          texture path
      ANAM (1 byte)
          unknown data
      FNAM (1 byte)
          unknown data
      MNAM (1 byte, optional)
          unknown data
      SNAM (4 bytes, optional)
          unknown data
      TNAM (4 bytes, optional)
          unknown data
      DATA (2 bytes)
          unknown data
      DNAM (228 bytes)
          unknown data
      GNAM (12 bytes)
          unknown data
      NAM0 (12 bytes, optional)
          unknown data
      NAM1 (12 bytes. optional)
          unknown data


  CLAS: classes
      EDID (string, NUL-terminated)
          editorID
      FULL (4 bytes)
          string ID of class name
      DESC (4 bytes)
          unknown data
      DATA (36 bytes)
          unknown data


  PERK: perks
      EDID (string, NUL-terminated)
          editorID
      VMAD (size varies, optional)
          unknown data
      FULL (4 bytes, optional)
          string ID of perk's name
      DESC (4 bytes)
          string ID of perk's description (can be zero)
      DATA (5 bytes)
          unknown data
      PRKE (3 bytes, optional)
          unknown data
      DATA (3 or 4 bytes, optional)
          unknown data
      PRKC (1 byte, optional)
          unknown data
      CTDA (32 bytes, optional)
          unknown data
      EPFT (1 byte, optional)
          unknown data
      EPFD (4 bytes, optional)
          unknown data
      PRKF (0 bytes, optional)
          unknown data

      -> subrecords after DATA (5) can be repeated in more or less regular sequence


  INGR: ingredients
      EDID (string, NUL-terminated)
          editorID
      VMAD (size varies, optional)
          unknown data
      OBND (12 bytes)
          unknown data
      FULL (4 bytes)
          string ID of ingredient's name(?)
      KSIZ (4 bytes)
          number of keywords/formIDs in KWDA
      KWDA (n*4 bytes, always follows KSIZ)
          array of keyword formIDs
      MODL (string, NUL-terminated)
          path to the scroll's mesh
      MODT (30 bytes)
          unknown data
      YNAM (4 bytes, optional)
          unknown data
      ZNAM (4 bytes, optional)
          unknown data
      DATA (8 bytes)
          unknown data
      ENIT (8 bytes)
          unknown data

        EFID (4 bytes)
            unknown data
        EFIT (12 bytes)
            unknown data

       --> EFID and EFIT (and no CTDAs) seem to form blocks, that occur exactly four times


  SCRL: scrolls
      EDID (string, NUL-terminated)
          editorID
      OBND (12 bytes)
          unknown data
      FULL (4 bytes)
          string ID of scroll's name
      KSIZ (4 bytes, optional)
          number of keywords/formIDs in KWDA
      KWDA (n*4 bytes, optional, always follows KSIZ)
          array of keyword formIDs
      MDOB (4 bytes)
          unknown data
      ETYP (4 bytes)
          unknown data
      DESC (4 bytes)
          string ID of scroll's description (can be zero)
      MODL (string, NUL-terminated)
          path to the scroll's mesh
      MODT (36 bytes)
          unknown data
      DATA (8 bytes)
          unknown data
      SPIT (36 bytes)
          unknown data

        EFID (4 bytes)
            unknown data
        EFIT (12 bytes)
            unknown data
        CTDA (32 bytes, optional)
            unknown data

       --> EFID (once), EFIT (once) and CTDAs seem to form blocks, that can occur multiple times


  SPEL: spells
      EDID (string, NUL-terminated)
          editorID
      OBND (12 bytes)
          unknown data
      FULL (4 bytes, optional)
          string ID of spell's name
      MDOB (4 bytes, optional)
          unknown data
      ETYP (4 bytes)
          unknown data
      DESC (4 bytes)
          string ID of spell's description (ID can be zero)
      SPIT (36 bytes)
          unknown data

        EFID (4 bytes)
            unknown data
        EFIT (12 bytes)
            unknown data
        CTDA (32 bytes, optional, can occur more than once)
            unknown data

      --> EFID (once), EFIT (once) and CTDA (0+ times) seem to form blocks, that can occur multiple times


  AACT: action(?)
      EDID (string, NUL-terminated)
          editorID


  AMMO: ammunition
      EDID (string, NUL-terminated)
          editorID
      OBND (12 bytes)
          unknown
      FULL (4 bytes, optional)
          string ID of object's full name
      MODL (string, NUL-terminated, optional)
          model path
      MODT (?? bytes, optional)
          unknown data
      YNAM (4 bytes)
          unknown, possibly form ID
      ZNAM (4 bytes)
          unknown, possibly form ID
      DESC (4 bytes)
          possibly string index
      KSIZ (4 bytes, optional)
          number of keywords in following KWDA
      KWDA (n * 4 bytes, optional)
          array of form IDs of keywords
      DATA (16 bytes)
          unknown data


  SOUN: sound
      EDID (string, NUL-terminated)
          editorID
      OBND (12 bytes)
          unknown
      FNAM (string, NUL-terminated) optional
          file name
      SNDD (36 bytes) optional
          unknown
      SDSC (4 bytes)
          unknown ("sound source"?)


  COBJ: craftable object (recipes)
      EDID (string, NUL-terminated)
          editorID
      COCT (4 bytes) (not present, if there are no CNTO subrecords)
          component count (uint32_t)
      CNTO (8 bytes, occurs 0+ times)
          formID of required component (uint32_t)
          count (uint32_t)
      CTDA (32 bytes, can occur multiple times, optional)
          unknown
      CNAM (4 bytes)
          some formID
      BNAM (4 bytes)
          another formID
      NAM1 (2 bytes)
          resulting quantity (uint16_t)


  MISC: misc. object
      EDID (string, NUL-terminated)
         editorID
      VMAD (size varies) optional
          unknown data
      OBND (12 bytes)
          unknown data
      FULL (4 bytes) optional
          string ID of object's full name
      MODL (string, NUL-terminated)
          model path
      MODT (size varies)
          unknown data
      MODS (size varies?) optional
          unknown data
      ICON (string, NUL-terminated) optional
          icon path
      KSIZ (4 bytes) optional
          number of uint32_ts in KWDA
      KWDA (KSIZ * 4 bytes) optional, follows KSIZ
          keyword formIDs (?)
      YNAM (4 bytes) optional
          unknown, formID(?)
      ZNAM (4 bytes) optional
          unknown, formID(?)
      DATA (8 bytes)
          uint32_t    value of object
          float       weight of object


  TXST: texture set
      EDID (string, NUL-terminated)
          editorID
      OBND (12 bytes)
          unknown data
      TX00 (string, NUL-terminated)
          first texture path
      TX01 (string, NUL-terminated) optional
          second texture path
      TX02 (string, NUL-terminated) optional
          third texture path
      TX03 (string, NUL-terminated) optional
          another texture path
      TX04 (string, NUL-terminated) optional
          another texture path
      TX05 (string, NUL-terminated) optional
          another texture path
      TX07 (string, NUL-terminated) optional
          another texture path
      DODT (36 bytes) optional
          unknown data
      DNAM (2 bytes)
          unknown data


  BOOK: book
      EDID (string, NUL-terminated)
          editorID
      VMAD (?? bytes, optional)
          unknown data
      OBND (12 bytes)
          unknown
      FULL (4 bytes, optional)
          string ID of book's title
      MODL (string, NUL-terminated)
          model path
      MODT (size varies)
          unknown data
      DESC (4 bytes)
          string ID of the book's text
      YNAM (4 bytes, optional)
          unknown
      KSIZ (4 bytes, optional)
          number of uint32_ts in KWDA
      KWDA (multiple of 4 bytes), follows KSIZ, therefore optional
          array of formIDs/uint32_t2, number of elements is specified in KSIZ
      DATA (10 bytes)
          unknown data
      INAM (4 bytes, optional)
          unknown
      CNAM (4 bytes)
          unknown


   ACTI: activator
       EDID (string, NUL-terminated)
          editorID
      VMAD (?? bytes, optional)
          unknown data
      OBND (12 bytes)
          unknown
      FULL (4 bytes, optional)
          unknown
      MODL (string, NUL-terminated, optional)
          model path
      MODT (?? bytes, optional)
          unknown
      MODS (?? bytes, optional)
          unknown
      DEST (8 bytes, optional)
          unknown
      DSTD (20 bytes, optional)
          unknown
      DMDL (string, NUL-terminated, optional)
          another model path
      DMDT (?? bytes, optional)
          unknown
      DMDS (?? bytes, optional)
          unknown
      DSTF (?? bytes, optional)
          unknown
      KSIZ (4 bytes, optional)
          number of uint32_ts in KWDA
      KWDA (multiple of 4 bytes), follows KSIZ, therefore optional
          array of formIDs/uint32_t2, number of elements is specified in KSIZ
      PNAM (4 bytes)
          unknown
      VNAM (4 bytes, optional)
          unknown
      WNAM (4 bytes, optional)
          unknown
      RNAM (4 bytes, optional)
          unknown
      FNAM (2 bytes)
          unknown
      KNAM (4 bytes, optional)
          unknown


  QUST: quest
      EDID (string, NUL-terminated)
          editorID
      VMAD (?? bytes, optional)
          unknown data
      FULL (4 bytes)
          unknown
      DNAM (12 bytes)
          unknown
      ENAM (4 bytes, optional)
          unknown
      FLTR (string, NUL-terminated, optional)
          filter of some sort
      NEXT (always zero bytes?)
          unknown/no data

        INDX (4 bytes)
            quest stage index
        QSDT (1 byte)
            set to 1, if it finished the quest
        CNAM (4 bytes)
            string ID of entry name?



      ANAM (4 bytes)
          unknown
      CTDA (32 bytes, optional, can occur multiple times)
          unknown
      ... and much more


  WOOP: Word of Power
      EDID (string, NUL-terminated)
          editorID
      FULL (4 bytes) optional
          string ID of the word's name (in dragon language)
      TNAM (4 bytes)
          string ID of the translated meaning


  SHOU: Dragon Shout
      EDID (string, NUL-terminated)
          editorID
      FULL (4 bytes) optional
          string ID of shout's full name
      MDOB (4 bytes) optional
          unknown data
      DESC (4 bytes)
          string ID of shout's description
      SNAM (12 bytes, occurs three times, once for every word of power)
          uint32_t    formID of a word of power for that shout
          uint8_t[8]  unknown data


  MGEF: magic effect
      EDID (string, NUL-terminated)
          editorID
      VMAD (?? bytes, optional)
          unknown data
      FULL (4 bytes, optional)
          string ID of effect's full name
      MDOB (4 bytes, optional)
          unknown
      KSIZ (4 bytes, optional)
          number of form IDs in following KWDA
      KWDA (n * 4 bytes, optional)
          array of form IDs, number given by KSIZ field
      DATA (152 bytes)
          unknown data
      SNDD (size varies, optional)
          unknown data
      DNAM (4 bytes)
          string ID of effect's description
      CTDA (32 bytes, optional, can occur multiple times)
          unknown data


  STAT: static record
      EDID (string, NUL-terminated)
          editor ID
      OBND (12 bytes)
          unknown data
      MODL (string, NUL-terminated)
           (optional - believe it or not, there's at least one STAT in Skyrim.esm without MODL)
          model path
      MODT (?? bytes, size varies, optional)
          unknown data
      MODS (size varies, optional)
          unknown data
      DNAM (8 bytes)
          unknown data
      MNAM (size varies, optional)
          unknown data


  OTFT: outfit record
      EDID (string, NUL-terminated)
          editor ID
      INAM (integral multiple of 4 bytes)
          array of formIDs that points to the items (clothing, armor) of that outfit


  ASTP: association type
      EDID (string, NUL-terminated)
          editor ID
      MPRT (string, NUL-terminated)
          male parent
      FPRT (string, NUL-terminated)
          female parent
      MCHT (string, NUL-terminated, optional)
          male child
      FCHT (string, NUL-terminated, optional)
          female child
      DATA (4 bytes)
          unknown data, looks like some kind of flag


  RELA: relationship
      EDID (string, NUL-terminated)
          editor ID
      DATA (16 bytes)
          unknown data - however, it looks like four uint32_t.
                 The first one seems to be a form ID, the second one seems to
                 be a form ID on some occasions, the other ones seem to be some
                 flags or counters.


  FLST: form list
      EDID (string, NUL-terminated)
          editor ID
      LNAM (4 bytes, occurs 0+ times)
          form ID


  WEAP: Weapon record
      EDID: editor ID (string, NUL-terminated)
      OBND (12 bytes)
          unknown data
      FULL (4 bytes?)
          unknown data
      MODL (string)
          model path (.NIF)
      MODT (12, 24 or 36 bytes possible?, maybe in general a multiple of 12 bytes)
          unknown data
      EITM (4 bytes)
          unknown data
      EAMT (2 bytes)
          unknown data
      ETYP (4 bytes)
          unknown data
      BIDS (4 bytes)
          unknown data
      BAMT (4 bytes)
          unknown data
      KSIZ (4 bytes)
          number of uint32_ts in KWDA
      KWDA (multiple of 4 bytes), follows KSIZ
          array of formIDs/uint32_t2, number of elements is specified in KSIZ
      DESC (4 bytes)
          unknown data (description?)
      INAM (4 bytes)
          unknown data
      WNAM (4 bytes)
          unknown data
      TNAM (4 bytes)
          unknown data
      NAM9 (4 bytes)
          unknown data
      NAM8 (4 bytes)
          unknown data
      DATA (10 bytes)
          unknown data
      DNAM (100 bytes)
          unknown data
      CRDT (16 bytes)
          unknown data
      VNAM (4 bytes)
          unknown data